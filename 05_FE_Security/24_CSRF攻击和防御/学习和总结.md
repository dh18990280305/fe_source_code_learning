### 一、CSRF 是什么
*CSRF（Cross-Site Request Forgery）跨站请求伪造*
攻击者诱导用户在已登录的状态下，访问恶意网站，恶意网站向目标网站发起请求，浏览器会*自动携带目标网站的 Cookie*，从而冒充用户执行未授权操作。
一句话：*借你的身份，替你干坏事*。

### 二、CSRF 攻击的 3 个必要前提（必考）
1. *用户已登录目标网站，Cookie 有效*
2. *目标网站未做 CSRF 防护*（不校验请求来源 / Token）
3. *攻击者构造好恶意请求链接 / 表单*，诱导用户点击 / 访问

*缺一不可。*

### 三、CSRF 攻击流程（极简版）
1. 用户登录 A 网站 → 浏览器保存 A 网站的登录 Cookie
2. 用户被诱导访问恶意网站 B
3. 网站 B 自动向 A 网站发送请求（转账、删帖、改密码）
4. 浏览器*自动带上 A 的 Cookie*
5. A 网站校验 Cookie 通过 → 执行操作 → 攻击成功

### 四、CSRF 防御方案（面试核心）
#### 1. Token 验证（最主流、最安全）
*原理*
- 服务器生成 CSRF Token，存入 Session 或返回前端
- 前端每次请求*必须携带 Token*
- 服务器对比 Token 是否一致
- Cookie 被盗也无法伪造 Token

*实现流程*

1. 登录 / 页面加载时，后端返回 CSRF Token
2. 前端存储 Token（header /form 隐藏域）
3. 请求时带上：headers: { X-CSRF-Token: xxx }
4. 后端校验 Token 是否合法

- 优点：安全、通用、支持跨域
- 缺点：需要前后端配合

#### 2. SameSite Cookie（现代浏览器默认）
*原理*

通过 Cookie 的 SameSite 属性控制跨站时是否携带 Cookie。

三个值：

1. *Strict*：完全不允许跨站携带
2. *Lax*：安全链接（GET 跳转）允许，POST 不允许（默认）
3. *None*：允许跨站（必须配合 HTTPS + Secure）

- 优点：*配置简单、浏览器原生支持*
- 缺点：*老浏览器不支持；不能完全防御 GET 型攻击*

#### 3. Referer / Origin 校验（辅助）
检查请求头 Referer 或 Origin 是否为合法域名。
- 优点：*简单*
- 缺点：请求头可伪造；部分场景不会携带 Referer

### 五、三种方案对比
| 方案 | 安全性 | 易用性 | 兼容性 | 推荐度 |
| -------- | -------- | -------- | -------- |
| CSRF Token | 最高 | 中 | 全兼容 | ⭐⭐⭐⭐⭐ |
| SameSite | 高 | 极高 | 现代浏览器	 | ⭐⭐⭐⭐ |
| Referer | 低 | 高 | 一般 | ⭐⭐ |

### 六、今日刷题（中厂高频 3 题）
#### 题 1：CSRF 攻击发生的必要条件是什么？
答案：
1. 用户已登录目标网站，Cookie 有效
2. 目标网站未做 CSRF 防护
3. 用户访问恶意网站并触发请求

#### 题 2：如何设计一套 CSRF Token 验证方案？（中厂高频大题）
答案（标准满分版）：
1. 用户登录后，服务器生成强随机 CSRF Token，存入 Session
2. 前端页面加载时获取 Token，存储在状态或隐藏域
3. 前端所有非 GET 请求（POST/PUT/DELETE）在 Header 中携带 X-CSRF-Token
4. 后端拦截器统一校验 Token 是否与 Session 一致
5. 每次操作可刷新 Token，提高安全性

#### 题 3：SameSite Cookie 的三个值及其作用？
- Strict：完全不允许跨站携带
- Lax：仅安全 GET 可携带，POST 不可（默认）
- None：允许跨站，必须配合 Secure + HTTPS
